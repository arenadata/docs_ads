Настройка пользователей и политик доступа
==========================================

В зависимости от характеристик настроенных параметров *UserGroupProvider* и *AccessPolicyProvider* пользователи, группы и политики могут конфигурироваться в пользовательском интерфейсе. Если расширения не настроены, то в пользовательском интерфейсе пользователи, группы и политики доступны только для чтения. Если сконфигурированный авторизатор не использует *UserGroupProvider* и *AccessPolicyProvider*, пользователи и политики могут быть или не быть видимыми и настраиваемыми в пользовательском интерфейсе на основе базовой реализации.

Далее в главе предполагается, что пользователи, группы и политики настраиваются в пользовательском интерфейсе, и описывается:

+ `Создание пользователей и групп`_
+ `Политики доступа`_
+ `Настройка политик доступа на основе конкретных примеров`_


Создание пользователей и групп
-------------------------------

В пользовательском интерфейсе необходимо выбрать "Users" в глобальном меню, при этом открывыается диалоговое окно для создания пользователей и групп и управления ими (:numref:`Рис.%s.<ADS_AdminNIFI_Policies_Users>`). Для создания пользователей и групп используется кнопка "Add User".


.. _ADS_AdminNIFI_Policies_Users:

.. figure:: ../imgs/ADS_AdminNIFI_Policies_Users.*
   :align: center

   Nifi Users


Для создания пользователя в новом открывшемся диалоговом окне необходимо выбрать "Individual" и ввести информацию "Identity", соответствующую методу аутентификации защиты инстанса **NiFi**. После чего нажать "ОК" (:numref:`Рис.%s.<ADS_AdminNIFI_Policies_Identity>`).


.. _ADS_AdminNIFI_Policies_Identity:

.. figure:: ../imgs/ADS_AdminNIFI_Policies_Identity.*
   :align: center

   Создание пользователя


Для создания группы в диалоговом окне следует выбрать "Group", ввести имя группы в поле "Identity" и отметить пользователей в "Members", которые необходимо включить в группу. После чего нажать "ОК" (:numref:`Рис.%s.<ADS_AdminNIFI_Policies_Group>`).


.. _ADS_AdminNIFI_Policies_Group:

.. figure:: ../imgs/ADS_AdminNIFI_Policies_Group.*
   :align: center

   Создание группы


Политики доступа
-----------------

Управление возможностями пользователей и групп **NiFi** осуществляется с помощью политик доступа. Существует два типа политик доступа, которые могут быть применены к ресурсу:

+ View (просмотр) -- если ресурсу назначается политика просмотра, то добавленные в эту политику пользователи и группы могут только видеть детали данного ресурса;

+ Modify (изменение) -- если ресурсу назначается политика изменения, то добавленные в эту политику пользователи и группы могут изменить конфигурацию данного ресурса.

Создавать и применять политики доступа можно как на глобальном уровне (`Global Access Policies`_), так и на уровне компонентов (`Component Level Access Policies`_).


Global Access Policies
^^^^^^^^^^^^^^^^^^^^^^^^

Политики глобального доступа управляют следующими полномочиями на уровне системы:

.. csv-table:: Global Access Policies
   :header: "Policy", "Privilege", "Global Menu Selection", "Resource Descriptor"
   :widths: 25, 25, 25, 25

   "view the UI", "Разрешение пользователям просматривать UI", "N/A", "/flow"
   "access the controller", "Позволяет пользователям просматривать/изменять контроллер, включая задачи отчетности, службы контроллеров и узлы в кластере", "Controller Settings", "/controller"
   "query provenance", "Позволяет пользователям отправлять Provenance Search и запрашивать Event Lineage", "Data Provenance", "/provenance"
   "access restricted components", "Позволяет пользователям создавать/изменять ограниченные компоненты при условии наличия других разрешений. Ограниченные компоненты могут указывать, какие конкретные разрешения требуются. Разрешения могут предоставляться для определенных ограничений или независимо от них. Если разрешение предоставляется независимо от ограничений, пользователь может создавать/изменять все ограниченные компоненты", "N/A", "/restricted-components"
   "access all policies", "Позволяет пользователям просматривать/изменять политики для всех компонентов", "Policies", "/policies"
   "access users/user groups", "Позволяет пользователям просматривать/изменять пользователей и группы пользователей", "Users", "/tenants"
   "retrieve site-to-site details", "Позволяет другим инстансам NiFi извлекать информацию site-to-site", "N/A", "/site-to-site"
   "view system diagnostics", "Позволяет пользователям просматривать системную диагностику", "Summary", "/system"
   "proxy user requests", "Позволяет прокси отправлять запросы от имени других пользователей", "N/A", "/proxy"
   "access counters", "Позволяет пользователям просматривать/изменять счетчики доступа", "Counters", "/counters"


Component Level Access Policies
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Политики доступа на уровне компонентов управляют следующими полномочиями на уровне компонентов:

.. csv-table:: Component Level Access Policies
   :header: "Policy", "Privilege", "Resource Descriptor & Action"
   :widths: 30, 30, 40

   "view the component", "Позволяет пользователям просматривать детали конфигурации компонентов", resource="/<component-type>/<component-UUID>" action="R"
   "modify the component", "Позволяет пользователям изменять детали конфигурации компонентов", resource="/<component-type>/<component-UUID>" action="W"
   "view provenance", "Позволяет пользователям просматривать события происхождения, созданные компонентом", resource="/provenance-data/<component-type>/<component-UUID>" action="R"
   "view the data", "Позволяет пользователям просматривать метаданные и содержимое компонента в очередях потока в исходящих соединениях и через события происхождения", resource="/data/<component-type>/<component-UUID>" action="R"
   "modify the data", "Позволяет пользователям очищать очереди потоков в исходящих соединениях и повторно отправлять через события происхождения", resource="/data/<component-type>/<component-UUID>" action="W"
   "view the policies", "Позволяет пользователям просматривать список пользователей, которые могут просматривать/изменять компонент", resource="/policies/<component-type>/<component-UUID>" action="R"
   "modify the policies", "Позволяет пользователям изменять список пользователей, которые могут просматривать/изменять компонент", resource="/policies/<component-type>/<component-UUID>" action="W"
   "receive data via site-to-site", "Позволяет порту получать данные из инстансов NiFi", resource="/data-transfer/input-ports/<port-UUID>" action="W"
   "send data via site-to-site", "Позволяет порту отправлять данные из инстансов NiFi", resource="/data-transfer/output-ports/<port-UUID>" action="W"

.. important:: Политики доступа можно применять ко всем типам компонентов, кроме соединений. Разрешения на соединения определяются по индивидуальным политикам доступа к исходному и целевому компонентам соединения, а так же по политике доступа группы процессов, содержащей компоненты. Более подробно это описано далее в примерах

.. important:: Для доступа к List Queue и Delete Queue для соединения пользователю требуются политики "view the data" и "modify the data" на компоненте. Так же все узлы в кластерной среде должны быть добавлены к этим политикам, так как запрос пользователя может быть реплицирован через любой узел в кластере


Настройка политик доступа на основе конкретных примеров
--------------------------------------------------------

