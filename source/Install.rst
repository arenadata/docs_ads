Установка Arenadata Streaming c помощью Ambari 2.7.0
==============================

.. |br| raw:: html

   <br />


Установка сервера **Ambari 2.7.0** проходит в несколько этапов:


+ Настройка удаленного репозитория YUM;
+ Установка сервера Ambari;
+ Настройка сервера Ambari;
+ Запуск сервера Ambari.




Настройка удаленного репозитория YUM
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Настройка удаленного репозитория не отличается от настройки любого дополнительного репозитория **YUM**. Для добавления репозитория необходимо выполнить от имени *root* команду:

  :command:`yum-config-manager –-add-repo http://public-repo-1.hortonworks.com/ambari/centos7/2.x/updates/2.7.0.0/ambari.repo`

Установка сервера Ambari
------------------------

Сервер **Ambari** устанавливается из RPM-пакета по команде **YUM**:

  :command:`yum install ambari-server`

Данная команда устанавливает сервер **Ambari**, являющийся сервером веб-приложений, на порт *8080*. Также устанавливает инстанс сервера
**PostgreSQL** на порт *5432*.



Настройка сервера Ambari
------------------------

Сервер **Ambari** необходимо настроить для корректной работы.

В случае если инстанс **PostgreSQL** настроен на порт по умолчанию, следует выполнить следующую команду:

  :command:`ambari-server setup`

В процессе настройки необходимо указать или принять по умолчанию параметры:


+ *Учетная запись пользователя* – для запуска Ambari-сервера можно выбрать любую учетную запись (необязательно выполнять вход от *root*). В случае если пользователя не существует, он создается автоматически;
+ *Java JDK* – для загрузки Oracle JDK 1.8 необходимо ввести значение *1* и принять лицензию Oracle JDK для загрузки файлов из Oracle. При этом установка JDK выполняется автоматически;
+ *База данных* – выбор базы данных:

  :command:`Enter advanced database configuration`

  В командной строке необходимо ответить *n* или *y*:

    + *n* – для использования с Ambari стандартной встроенной базы данных PostgreSQL. По умолчанию для базы данных PostgreSQL устанавливается имя "ambari" и логин / пароль принимают значения *ambari / bigdata*.

    + *y* – при необходимости использования с Ambari уже существующей базы данных PostgreSQL, MySQL или Oracle вместо предлагаемой по умолчанию. Далее для выбранной базы данных необходимо указать параметры подключения (см. `Приложение 1. <http://docs.arenadata.io/addb/install/annex.html>`_).



Запуск сервера Ambari
---------------------


После установки сервера **Ambari** запуск его осуществляется по команде:

  :command:`ambari-server start`

Для проверки статуса сервера необходимо использовать команду:

  :command:`ambari-server status`

Для остановки сервера необходимо использовать команду:

  :command:`ambari-server stop`

Сервер **Ambari** доступен на порту *8080*. По умолчанию для него установлена следующая учетная запись:

  User: *admin*

  Password: *admin*

.. important:: Рекомендуется сменить пароль после первого входа в систему

Для входа в веб-интерфейс **Ambari** необходимо в адресной строке браузера указать адрес сервера:

  :command:`http://<адрес сервера>:8080`

При этом запрашивается логин и пароль. После авторизации открывается веб-интерфейс **Ambari** (:numref:`Рис.%s.<install_installation_welcom-to-ambari-before-config>`).

.. _install_installation_welcom-to-ambari-before-config:

.. figure:: ./imgs/install_installation_welcom-to-ambari27-before-config.*
   :align: center

   Веб-интерфейс Ambari до настройки кластера



Подготовка к установке Arenadata Streaming MPack
==========================================================


Основные компоненты **ADS** устанавливаются с помощью Ambari Management Pack (MPack)

+ Загрузка Arenadata Streaming MPack;
+ Импортирование MPack в Ambari стек.



Загрузка Arenadata Streaming MPack
----------------------------------


Необходимо загрузить и распаковать следующие архивы в выделенном для них месте (при этом следует избегать использования каталога */tmp*):


+ *ads-ambari-mpack-{version}.tar.gz* – набор конфигураций севрвисов и скриптов для развертывания инастройки платформы через Ambari;


В случае если архивы загружены в каталог */tmp*, то для их распаковки в каталоге, например, */staging* необходимо выполнить следующую команду:

  :command:`tar –xzvf /tmp/ads-ambari-mpack-{version}.tar.gz -C /staging/`



Импортирование MPack в Ambari стек
----------------------------------

Для испортирование стека ADS в **Ambari** необходимо выполнить следующие комманды:

1. Сохраните текущую папку Ambari Resources для возможного восстановления системы

  :command:`cp -r /var/lib/ambari-server/resources /var/lib/ambari-server/resources.backup`

2. Запустите комманду импорта стека ADS
  :command:`ambari-server install-mpack --mpack=/staging/ads-ambari-mpack-{version}.tar.gz --purge --verbose`

3. Перезааустите ambari

  :command:`ambari-server restart`
