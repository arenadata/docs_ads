Удаление/Добавление компонентов сервиcа Nifi
=============================================

*Доступно с версии 1.4.11*

Если кластер **ADS** разворачивается с помощью **ADCM**, то операции по добавлению/удалению хоста в сервис *NiFi* могут быть выполнены автоматически. После выполнения планирования нового аппаратного обеспечения необходимо добавить новые хосты в выбранный кластер в интерфейсе **ADCM**, используя кнопку "Add hosts" на вкладке "Hosts". Кроме того, необходимо выполнить инициализацию каждого хоста, если того требует провайдер хостов.

.. important:: Описанные ниже операции не удаляют/добавляют хост из кластера -- они лишь управляют компонентом *NiFi Server* и *NiFi-Registry* на хостах. Удаление хоста из кластера возможно в разделе “Hosts” кластера при условии, что к хосту не привязан ни один компонент

Для добавления или удаления *Nifi* с хостов необходимо воспользоваться соответствующими кнопками выпадающего меню, доступного по нажатию на иконку в поле “Actions” сервиса *Nifi* (:numref:`Рис.%s <nifi_action>`).

.. _nifi_action:

.. figure:: ../imgs/nifi_action.png
   :align: center

   Список допустимых операций над сервисом Nifi



Добавление компонентов Nifi Server и Niifi-Registry
---------------------------------------------------

Когда хосты становятся доступными для подключения по ssh для менеджера кластеров, необходимо выбрать действие *Expand* cервиса *Nifi* из списка возможных операций (см. :numref:`Рис.%s <nifi_action>`). В появившемся диалоговом окне предоставляется выбор следующих опций (:numref:`Рис.%s <expand_config_menu>`):

* *Disable SELinux before cluster installation* -- отключение SELinux на добавляемых хостах. Для того, чтобы данная настройка применилась, после завершения операции *Expand* необходимо перезагрузить хосты вручную;

* *Disable Firewalld before cluster installation* -- выключение firewalld на добавляемых хостах;

* *Install OpenJDK before cluster installation* -- установка пакета *java-1.8.0-openjdk* на добавляемых хостах;

* *Set vm.swappiness to 0 for all hosts* -- отключение *swapping* на добавлемых хостах;

* *Append hosts into /etc/hosts file before cluster installation* -- запись добавляемых нод в */etc/hosts* на всех хостах кластера. Данную опцию рекомендуется отключить, если настроен DNS.


.. _expand_config_menu:

.. figure:: ../imgs/expand_config_menu.png
   :align: center

   Доступные при расширении настройки


После выбора опций для перехода к следующей странице конфигурации следует нажать кнопку "Next", и в открывшейся форме необходимо распределить компонент *Nifi Server* по добавляемым хостам (:numref:`Рис.%s <expand_nifi_hc_menu>`). Также есть возможность установить *Nifi-Registry*, если ранее он не был установлен. В случае если используется сервис *Monitoring Clinets*, его компоненты также необходимо разместить на добавляемых хостах.

.. _expand_nifi_hc_menu:

.. figure:: ../imgs/expand_nifi_hc_menu.png
   :align: center
   
   Распределение компонента по хостам

Расширение сервиса запускается кнопкой "Run". На добавленные хосты устанавливаются необходимые пакеты и производится их настройка. Текущая конфигурация *Flow*, представленная в *flow.xml.gz*, копируется на новый хост.


Удаление Nifi Server
---------------------

Для удаления одного или нескольких Nifi Server с хостов кластера необходимо:

1. Выбрать действие *Shrink* cервиса *Nifi* из списка возможных операций (см. :numref:`Рис.%s <nifi_action>`), что приводит к появлению окна распределения компонента по хостам (см. :numref:`Рис.%s <expand_nifi_hc_menu>`);

2. Любым из двух способов удалить привязку компонента к хосту (компонент *Nifi Server* выделяется белым цветом, как возможный к удалению с хостов):

- Выбрать компонент в колонке "Components" и убрать выделение с хостов в колонке "Hosts", рамки которых выделены зеленым цветом;

- Выбрать хост в колонке "Hosts" и убрать выделение с компонента *Nifi Server* в колонке "Components", если рамка компонета *Nifi Server* выделяется зеленым цветом.

3. Нажать кнопку "Run" в нижней части окна.

.. important:: Описанная процедура не удаляет данные и пакет *NiFi* c хоста -- онa лишь выводит ноду из кластера *NiFi*

