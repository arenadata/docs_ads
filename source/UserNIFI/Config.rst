Настройка Процессора
=====================


Окно настройки Процессора открывается по двойному щелчку по Процессору в рабочей области либо при выборе опции "Configure" из контекстного меню Процессора. Диалоговое окно конфигурации имеет четыре вкладки, каждая из которых описана далее. После завершения настройки Процессора для применения изменений следует нажать кнопку "Apply"; для выхода из окна без сохранения -- кнопку "Cancel".

При запущенном Процессоре в его контекстном меню опция "Configure" меняется на "View Configuration", так как нельзя менять конфигурацию Процессора во время его работы. Для этого необходимо сначала остановить Процессор и дождаться завершения всех его активных задач.

.. important:: Ввод определенных символов не поддерживается и автоматически отфильтровывается при вводе. Следующие символы и любые непарные суррогатные коды Unicode не сохраняются ни в одной конфигурации:

  :: 
  
   [#x0], [#x1], [#x2], [#x3], [#x4], [#x5], [#x6], [#x7], [#x8], [#xB], [#xC], [#xE], [#xF], [#x10], [#x11], [#x12], [#x13], [#x14], [#x15], [#x16], [#x17], [#x18], [#x19], [#x1A], [#x1B], [#x1C], [#x1D], [#x1E], [#x1F], [#xFFFE], [#xFFFF]


Вкладка SETTINGS
-----------------

При обращении к диалоговому окну настроек Процессора, оно открывается на первой вкладке "SETTINGS" (:numref:`Рис.%s.<ADS_UserNIFI_Config_SETTINGS>`).


.. _ADS_UserNIFI_Config_SETTINGS:

.. figure:: ../imgs/ADS_UserNIFI_Config_SETTINGS.*
   :align: center

   Вкладка SETTINGS


Вкладка содержит несколько элементов конфигурации. В поле "Name" у DFM есть возможность изменить имя Процессора. По умолчанию оно совпадает с типом. Рядом с полем имени располагается флажок "Enabled", указывающий статус Процессора. При добавлении Процессора на рабочую область он активируется, и если его отключить, дальнейший запуск уже невозможен. Отключенное состояние используется для указания того, что, например, при запуске группы Процессоров данный (отключенный) Процессор следует исключить.

Ниже отображается уникальный идентификатор Процессора в поле "Id", его тип в поле "Type" и NAR в поле "Bundle". Данные значения не могут быть изменены.

Далее находятся поля "Penalty Duration" и "Yield Duration". Во время обычного процесса обработки потока данных (FlowFile) может произойти событие, указывающее, что данные могут быть обработаны не в данный момент, а позднее. Например, если Процессор должен передать данные удаленному сервису, но у сервиса уже есть одноименный файл. В таком случае Процессор может "оштрафовать" FlowFile сроком ожидания, что останавливает обработку данных потока на период времени, заданный в поле "Penalty Duration" (по умолчанию *30 секунд*).

Аналогичным образом Процессор может определить, что существует ситуация, при которой он больше не может выполнять действия независимо от обрабатываемых данных. Например, если Процессор должен отправить данные в удаленный сервис, но сервис не отвечает, Процессор при этом не может добиться какого-либо прогресса. В результате Процессор должен "уступить", а это отодвигает запланированный запуск Процессора на некоторый период времени, который задается в поле "Yield Duration" (значение по умолчанию *1 секунда*).

Последний настраиваемый параметр в левой части вкладки -- "Bulletin Level". Всякий раз, когда Процессор записывает данные в свой журнал, он также создает бюллетень. В параметре указывается самый низкий уровень бюллетеня. По умолчанию установлено значение *WARN*, означающее, что в пользовательском интерфейсе отображаются все бюллетени с предупреждениями и ошибками.

В правой части вкладки "SETTINGS" находится "Automatically Terminate Relationships" c перечислением всех определенных Процессором связей и их описанием. Для того чтобы Процессор считался действительным и способным к запуску, каждая определенная им связь должна быть подключена к нисходящему компоненту, в противном случае она автоматически прерывается. При автоматическом прерывании связи любой направляемый в нее FlowFile удаляется из потока, и его обработка считается завершенной. Любая связь, которая уже подключена к нисходящему компоненту, не может быть автоматически завершена, для этого связь должна быть сначала удалена из использующих ее Соединений. Кроме того, у предназначенной к автоматическому прерыванию связи при ее добавлении к Соединению статус "auto-termination" отключается.


Вкладка SCHEDULING
--------------------

"SCHEDULING" -- вторая вкладка диалогового окна настроек Процессора (:numref:`Рис.%s.<ADS_UserNIFI_Config_SCHEDULING>`).


.. _ADS_UserNIFI_Config_SCHEDULING:

.. figure:: ../imgs/ADS_UserNIFI_Config_SCHEDULING.*
   :align: center

   Вкладка SCHEDULING


Вкладка содержит несколько элементов конфигурации:

+ `Scheduling Strategy`_
+ ``_
+ ``_
+ ``_


Scheduling Strategy
^^^^^^^^^^^^^^^^^^^^

В поле стратегии планирования "Scheduling Strategy" есть три возможных варианта планирования компонентов:

+ *Timer driven* -- режим по умолчанию -- запуск Процессора осуществляется с регулярным интервалом, определенным опцией "Run Schedule";

+ *Event driven* -- в данном режиме Процессор инициируется с выполнением события, когда FlowFiles входят в Соединения, относящиеся к Процессору. Режим в настоящее время считается экспериментальным и не поддерживается всеми Процессорами. В данном режиме опция "Run Schedule" недоступна для конфигурации, так как Процессор запускается не по периодам, а в результате выполнения события. Кроме того, это единственный режим, для которого параметр "Concurrent Tasks" может быть установлен равным *0*, так как количество потоков ограничено только размером Event-Driven Thread Pool, настроенным администратором;

+ *CRON driven* -- запуск Процессора осуществляется периодически, подобно режиму *Timer driven*. Однако *CRON driven* обеспечивает значительно большую гибкость за счет увеличения сложности конфигурации, представляющую собой строку из шести обязательных полей и одного опционального, разделенных пробелом. 


.. csv-table:: Конфигурация стратегии планирования CRON driven
   :header: "Поле", "Допустимые значения"
   :widths: 50, 50

   "Seconds", "0-59"
   "Minutes", "0-59"
   "Hours", "0-23"
   "Day of Month", "1-31"
   "Month", "1-12 или JAN-DEC"
   "Day of Week", "1-7 или SUN-SAT"
   "Year (опционально)", "Пусто или 1970-2099"


Обычно значения задаются одним из следующих способов:

+ *Number* -- одно или несколько допустимых значений, разделенных запятыми;
+ *Range* -- диапазон значений в виде <number>-<number>;
+ *Increment* -- инкремент с использованием синтаксиса <start value>/<increment>. Например, в поле "Minutes" значение *0/15* обозначает последовательность минут *0*, *15*, *30* и *45*.

Кроме того, могут быть использованы специальные символы:

+ Символ * -- означает, что все значения действительны;
+ Символ ? -- означает, что может быть задано не характерное значение (допустипо в полях "Day of Month" и "Day of Week");
+ Символ L -- можно добавить *L* к одному из значений дня недели, чтобы указать последнее вхождение этого дня в месяце. Например, *1L* обозначает последнее воскресенье месяца.






