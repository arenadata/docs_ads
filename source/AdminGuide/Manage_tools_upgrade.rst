Обновление кластера ADS
=========================

*Доступно с версии 1.4.11*

**ADCM** предоставляет возможность обновления существующего кластера **ADS**.

Процесс обновления состоит из двух последовательных шагов:

* Обновление бандла;
* Обновление кластера.

.. important:: В текущей версии доступно обновление кластеров как версий *1.3.X*, так и *1.4.X*


Обновление бандла
------------------

Для обновления бандла необходимо:

1. Загрузить бандл *ADS* новой версии. После его загрузки на вкладке "Clusters" в строке кластера с более старой версией бандла в колонке "Upgrade" появляется пиктограмма, указывающая на возможность обновления (:numref:`Рис.%s <manage_tools_bundle_upgrade>`).

.. _manage_tools_bundle_upgrade:

.. figure:: ../imgs/manage_tools_bundle_upgrade.png
   :align: center

   Доступно обновление бандла


2. Нажать на пиктограмму в колонке "Upgrade" и выбрать доступную требуемую версию из списка (:numref:`Рис.%s <manage_tools_choose_bundle_upgrade>`).

.. _manage_tools_choose_bundle_upgrade:

.. figure:: ../imgs/manage_tools_choose_bundle_upgrade.png
   :align: center

   Доступные обновления


3. В открывшемся диалоговом окне подтвердить действие, после чего кластер меняет состояние на *upgrade from 1.3.X* или *upgrade from 1.4.X* в зависимости от установленной версии бандла (:numref:`Рис.%s <manage_tools_cluster_upgrade_state>`).

.. _manage_tools_cluster_upgrade_state:

.. figure:: ../imgs/manage_tools_cluster_upgrade_state.png
   :align: center

   Изменение состояния кластера после обновления


.. important:: При установленном сервисе *Monitoring Clients* после обновления бандла необходимо произвести повторный `импорт конфигурационных параметров кластера мониторинга <../Install/create_cluster/index.html#id5>`_.

.. important:: Если заданные по умолчанию настройки сервисов *Zookeeper*, *Kafka* и *Nifi* изменены, то их необходимо скопировать и сохранить прежде, чем приступить к обновлению конфигураций сервисов. В частности это касается файлов *nifi.properties*, *zoo.cfg* и *server.properties* сервиcов *Nifi*, *Zookeeper* и *Kafka* соответственно


Обновление кластера
--------------------

После завершения операции "Upgrade Configs" в кластере становится доступным действие "Upgrade". Данная операция применяет новые настройки, полученные на предыдущем шаге, и обновляет пакеты всех сервисов до указанных версий.

1. В поле "Actions" для обновляемого кластера нажать на пиктограмму и выбрать действие "Upgrade" (:numref:`Рис.%s <manage_tools_cluster_upgrade>`).

.. _manage_tools_cluster_upgrade:

.. figure:: ../imgs/manage_tools_cluster_upgrade.png
   :align: center

   Обновление пакетов сервисов

2. Подтвердить действие в открывшемся диалоговом окне нажатием кнопки "Run".

После успешного завершения операции "Upgrade" кластеру присваивается состояние *installed*.


.. important:: Если заданные по умолчанию настройки сервисов были изменены перед обновлением, то после операции "Upgrade Configs" необходимо выполнить действия для соответствующих сервисов:

* Перейти к настройкам сервиса *Zookeeper*, проверить раздел *zoo.cfg* и при необходимости внести сохраненные ранее изменения;

* Перейти к настройкам сервиса *Kafka*, проверить разделы *Main* и *server.properties* и при необходимости внести сохраненные ранее изменения;

* Перейти к настройкам сервиса *Nifi*, проверить разделы *Main*, *Directories* и *nifi.properties* и при необходимости внести сохраненные ранее изменения.
